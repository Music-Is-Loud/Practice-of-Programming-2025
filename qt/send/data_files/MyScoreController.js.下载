var myScoreCtrl = angular.module('dc.controller.myScore.myScoreCtrl', []);	
myScoreCtrl.controller("myScoreController",['$scope','$http',function($scope,$http){
	$scope.errorMsg = "正在查询中……";

	$scope.showYjscjxx=false;
	$scope.showBkscjxx=false;
	$scope.showBksfscjxx=false;
	$scope.showBkszjlcjxx=false;
	$scope.showBksbylwcjxx=false;
		
	$scope.yjscjxx = [];
	$scope.bkscjxx = [];
	$scope.bksfscjxx = [];
	$scope.bkszjlcjxx = [];
	$scope.bksbylwcjxx = {};
	$scope.bksgpa = {};
	$scope.xslb = "";
		
	$scope.getGPA = function(){
		$scope.showYjscjxx=false;
		$scope.showBkscjxx=false;
		$scope.showBksfscjxx=false;
		$scope.showBkszjlcjxx=false;
		$scope.showBksbylwcjxx=false;
		$('#gpaDIV').css('display','block');
		$("#gpa").css("color","#8f000b");
		$("#yjscjxx").css("color","#000");
		$("#bkscjxx").css("color","#000");
		$("#bksfscjxx").css("color","#000");
		$("#bkszjlcjxx").css("color","#000");
		$("#bksbylwcjxx").css("color","#000");
	};
		
	$scope.getYjscjxx = function(){
		$scope.showYjscjxx=true;
		$scope.showBkscjxx=false;
		$scope.showBksfscjxx=false;
		$scope.showBkszjlcjxx=false;
		$scope.showBksbylwcjxx=false;
		$('#gpaDIV').css('display','none');
		$("#gpa").css("color","#000");
		$("#yjscjxx").css("color","#8f000b");
		$("#bkscjxx").css("color","#000");
		$("#bksfscjxx").css("color","#000");
		$("#bkszjlcjxx").css("color","#000");
		$("#bksbylwcjxx").css("color","#000");
	};
		
	$scope.getBkscjxx = function(){
		$scope.showYjscjxx=false;
		$scope.showBkscjxx=true;
		$scope.showBksfscjxx=false;
		$scope.showBkszjlcjxx=false;
		$scope.showBksbylwcjxx=false;
		$('#gpaDIV').css('display','none');
		$("#gpa").css("color","#000");
		$("#yjscjxx").css("color","#000");
		$("#bkscjxx").css("color","#8f000b");
		$("#bksfscjxx").css("color","#000");
		$("#bkszjlcjxx").css("color","#000");
		$("#bksbylwcjxx").css("color","#000");
	};
		
	$scope.getBksfscjxx = function(){
		$scope.showYjscjxx=false;
		$scope.showBkscjxx=false;
		$scope.showBksfscjxx=true;
		$scope.showBkszjlcjxx=false;
		$scope.showBksbylwcjxx=false;
		$('#gpaDIV').css('display','none');
		$("#gpa").css("color","#000");
		$("#yjscjxx").css("color","#000");
		$("#bkscjxx").css("color","#000");
		$("#bksfscjxx").css("color","#8f000b");
		$("#bkszjlcjxx").css("color","#000");
		$("#bksbylwcjxx").css("color","#000");
	};
			
	$scope.getBkszjlcjxx = function(){
		$scope.showYjscjxx=false;
		$scope.showBkscjxx=false;
		$scope.showBksfscjxx=false;
		$scope.showBkszjlcjxx=true;
		$scope.showBksbylwcjxx=false;
		$('#gpaDIV').css('display','none');
		$("#gpa").css("color","#000");
		$("#yjscjxx").css("color","#000");
		$("#bkscjxx").css("color","#000");
		$("#bksfscjxx").css("color","#000");
		$("#bkszjlcjxx").css("color","#8f000b");
		$("#bksbylwcjxx").css("color","#000");
	};
		
	$scope.getBksbylwcjxx = function(){
		$scope.showYjscjxx=false;
		$scope.showBkscjxx=false;
		$scope.showBksfscjxx=false;
		$scope.showBkszjlcjxx=false;
		$scope.showBksbylwcjxx=true;
		$('#gpaDIV').css('display','none');
		$("#gpa").css("color","#000");
		$("#yjscjxx").css("color","#000");
		$("#bkscjxx").css("color","#000");
		$("#bksfscjxx").css("color","#000");
		$("#bkszjlcjxx").css("color","#000");
		$("#bksbylwcjxx").css("color","#8f000b");
	};
		
	$scope.retrScores = function(){
		$http({
	    	method:'GET',
	        dataType: "json",
	        contentType:'application/json; charset=UTF-8',
	        url:'/publicQuery/ctrl/topic/myScore/retrScores.do'
	    }).success(function(response){
	        if(response.success==true){
	        	$scope.errorMsg = '';	        		
	        	$scope.xslb = response.xslb;
	        	$scope.yjscjxx = response.scoreLists;
	        	$scope.bkscjxx = response.cjxx;
	        	$scope.bksfscjxx = response.fscjxx;
	        	$scope.bkszjlcjxx = response.zjlcjxx;
	        	$scope.bksbylwcjxx = response.bylwcjxx;
	        		
	        	$scope.gpa = response.gpa;
	        	if("yjs"==$scope.xslb){
	        		$scope.getYjscjxx();
	        	}else{	
	        		$http({
	        	    	method:'GET',
	        	        dataType: "json",
	        	        contentType:'application/json; charset=UTF-8',
	        	        url:'/publicQuery/ctrl/topic/myScore/getGPAbyXh.do'
	        	    }).success(function(response){
	        	        if(response.success==true){
	        	        	var gpaInfo = response.data;
	        	        	if(gpaInfo.length>0){
	        	        		$scope.getGPA();
		        	        	var xAxis = [];
		        	        	var yAxis = [];
		        	        		
		        	        	for(var i=gpaInfo.length-1;i>=0;i--){
		        	        		var xndxq = gpaInfo[i].xndxq;
		        	        		xAxis.push(xndxq);
		        	        		var gpa = gpaInfo[i].gpa;
		        	        		yAxis.push(gpa);
		        	        	}
		        	        	var charts = document.getElementById("gpaInfo");
		        	        	var option = {
		        	        		tooltip : {
		        	        			trigger: 'axis'
		        	        		},
		        	        		grid: { // 控制图的大小，调整下面这些值就可以，
		        	        	    	x: 50,
		        	        	        x2: 50,
		        	        	        y2: 100,// y2可以控制 X轴跟Zoom控件之间的间隔，避免以为倾斜后造成 label重叠到zoom上
		        	        	        y: 50
		        	        	   	},
		        	        		calculable : false,
		        	        		xAxis : [{
		        	        			name:'学年度学期',
		        	        			type : 'category',
		        	        			data : xAxis,
		        	        			axisLine:{
		        	                    	lineStyle:{
		        	                        	color:'#565656'
		        	                        }
		        	                    },
		        	        			axisLabel: {
		        	        				show: true,
		        	        				interval: '0',
		        	        				rotate: 45,
		        	        				margin: 5
		        	        			}
		        	        		}],
		        	        		yAxis : [{
		        	        			name:'GPA',
		        	        			type : 'value',
		        	        			max:4,
		        	        			min:0,
		        	        			axisLine:{
		        	                    	lineStyle:{
		        	                        	color:'#565656'
		        	                        }
		        	                    }
		        	        		}],
		        	        		series : [{
		        	        			name:'GPA',
		        	        			type:'line',
		        	        			symbolSize:10,
		        	        			data:yAxis,
		        	        			itemStyle: {
		        	        				normal: {
		        		        				label: {
		        			        			    show: true,
		        			        			    position: 'top',
		        			        			    formatter: null,
		        			        			    textStyle: {
		        				        			    fontSize: 12,
		        				        			    fontStyle: 'normal',
		        			        			    	fontWeight: 'normal'
		        		        			    	}
		        		        			    }
		        	        			    }
		        	        			}
		        	        		}]
		        	        	};
		        	        	charts = echarts.init(charts);
		        				charts.setOption(option, true);
	        	        	}else{
	        	        		$scope.getBkscjxx();
	        	        	}
	        	        }else{
	        	        	$scope.getBkscjxx();
	        	        }
	        	  	}).error(function(){
	        	        $scope.getBkscjxx();
	        	 	 });
	        	}
	        }else{
	        	$scope.errorMsg = response.errorMsg;
	        }
	    }).error(function(){
	        $scope.errorMsg = "服务器没有响应";
	    });
	};
		
	$(window).resize(function() {
		var myChart0 = echarts.getInstanceById($("#gpaInfo").attr("_echarts_instance_"));
	    if(null!=myChart0){
	        myChart0.resize();
	    }
	});
		
	var init = function() {
        $scope.retrScores();
    };
    init();
}]);