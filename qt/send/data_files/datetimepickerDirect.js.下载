var datetimepickerDirect = angular.module('dc.direct.datetimepickerDirect', []);
datetimepickerDirect.directive('datetimepicker', function() {
	return {
		require: '?ngModel',
		restrict: 'A',
        replace :true,
        scope:{
        	ngModel: '=',
        	format:'@',
        	startView:'@',
        	minView:'@',
        	viewSelect:'@',
        	startDate:'@',
        	endDate:'@',
        	language:'@'
        	//attr:'@'
        },
        link: function(scope, element, attr, ngModel) {
        	$.fn.datetimepicker.dates['zh-CN'] = {
        		days: ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六", "星期日"],
        		daysShort: ["周日", "周一", "周二", "周三", "周四", "周五", "周六", "周日"],
        		daysMin:  ["日", "一", "二", "三", "四", "五", "六", "日"],
        		months: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
        		monthsShort: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
        		today: "今天",
        		suffix: [],
        		meridiem: ["上午", "下午"],
        		rtl: false // 从右向左书写的语言你可以使用 rtl: true 来设置
        	};
        	
        	$.fn.datetimepicker.dates['zh-CN-M'] = {
            	days: ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六", "星期日"],
            	daysShort: ["周日", "周一", "周二", "周三", "周四", "周五", "周六", "周日"],
            	daysMin:  ["日", "一", "二", "三", "四", "五", "六", "日"],
            	months: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
            	monthsShort: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
            	today: "本月",
            	suffix: [],
            	meridiem: ["上午", "下午"],
            	rtl: false // 从右向左书写的语言你可以使用 rtl: true 来设置
            };
        	
        	var _config = {//基础属性设置
        		language:  attr.hasOwnProperty('language')?attr.language:'zh-CN',
        		autoclose: true,
        		startDate:attr.hasOwnProperty('startDate')?attr.startDate:'',
//        		endDate:attr.hasOwnProperty('endDate')?attr.endDate:new Date(),
        		todayBtn:true,
        		todayHighlight:true,
        		format: attr.format != undefined && attr.format != '' ? attr.format:'yyyy-mm-dd',
        		startView : attr.startView != undefined && attr.startView != '' ? attr.startView : 'month',
        		minView : attr.minView != undefined && attr.minView != '' ? attr.minView : 'month',
        		viewSelect:attr.viewSelect != undefined && attr.viewSelect != '' ? attr.viewSelect : 'month'
        	};
        	element.datetimepicker(_config);
        	ngModel.$render = function() {
        		element.val(ngModel.$viewValue || '');
        	};
        	element.on('blur keyup change', function() {
        		scope.$apply(setViewValue);
        	});
        	setViewValue();
        	function setViewValue() {
        		var val = element.val();
        		ngModel.$setViewValue(val);
        	}	
        }
    };
});