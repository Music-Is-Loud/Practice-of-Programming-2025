var cadreContactCtrl = angular.module('dc.controller.cadreContact.cadreContactCtrl', []);	
cadreContactCtrl.controller("cadreContactController",['$scope','$http', function($scope,$http){
	$scope.myCadreContactErrMsg = "";
	$scope.cadreContactList=[];
	$scope.cadreContactInfo={};
	$scope.myCadreContact = {
		email:'',
		telephone:'',
		mobile:''
	};
	$scope.isPub="";
	$scope.searchWord="";
		
	$scope.changeKeyword = function(){
		var searchWord = $("#keyword").val();
		if(searchWord==null || searchWord=="")
			$("#clear_btn").hide();
		else
			$("#clear_btn").show();
	};
		
	$scope.enterKeyword = function(e) {
		var keycode = window.event?e.keyCode:e.which;
		if(keycode==13){
		    $scope.searchWord = $("#keyword").val();
		    $scope.searchCadres();
		}
	};
		
	$scope.clear = function(e){
		$scope.searchWord=null;
		$("#clear_btn").hide();
		$("#keyword").val();
		$("#keyword").select();
	};
		
	$scope.getMyContact = function(){
		$http({
	    	method:'GET',
	        dataType: "json",
	        contentType:'application/json; charset=UTF-8',
	        url:'/publicQuery/ctrl/common/cadreContact/getMyContact.do'
	    }).success(function(response){
	        if(response.success==true){
	        	$scope.isPub = response.isPub;
	        	$scope.myCadreContact.email = response.email;
	        	$scope.myCadreContact.telephone = response.telephone;
	        	$scope.myCadreContact.mobile = response.mobile;
	        	$scope.myCadreContactErrMsg=null;
	        }else{
	        	$scope.myCadreContact = null;
	        	$scope.myCadreContactErrMsg=response.msg;
	        }
	    }).error(function(){
	        $scope.myCadreContactErrMsg="服务器没有响应！";    
	    });
	};

	$scope.saveMyContactPub = function(isPub){	
		$http({
			method:'GET',
		    dataType: "json",
		    contentType:'application/json; charset=UTF-8',
		    url:'/publicQuery/ctrl/common/cadreContact/saveMyContactPub.do',
		    params:{isPub:isPub}
		}).success(function(response){
		    if(response.success==true){
		        $scope.getMyContact();
		        $scope.myCadreContactErrMsg=null;
		   	}else{
		        $scope.myCadreContactErrMsg=response.msg;
		    }
		}).error(function(){
			$scope.myCadreContactErrMsg="服务器没有响应！";  
		});
	};
		
	$scope.searchCadres = function(){
		if($scope.searchWord!=null && $scope.searchWord!=""){
			$http({
		    	method:'GET',
		        dataType: "json",
		        contentType:'application/json; charset=UTF-8',
		        url:'/publicQuery/ctrl/common/cadreContact/searchCadres.do',
		        params:{keyword:$scope.searchWord}
		    }).success(function(response){
		       	if(response.success==true){
		        	$scope.cadreContactList = response.rows;
		        	$scope.errorMsg=null;
		        }else{
		        	$scope.cadreContactList = null;
		        	$scope.errorMsg=response.msg;
		        }
		  	}).error(function(){
		        $scope.errorMsg="服务器没有响应！"; 
		    });
		}
	};
		
	$scope.getCadresContact = function(personId,record){
		$http({
	    	method:'GET',
	        dataType: "json",
	        contentType:'application/json; charset=UTF-8',
	        url:'/publicQuery/ctrl/common/cadreContact/getCadresContact.do',
	        params:{personId:personId}
	   	}).success(function(response){
	        if(response.success==true){
	        	record.telephone = response.telephone;
	        	record.mobile = response.mobile;
	        	record.email = response.email;
	        	$scope.errorMsg=null;
	        }else{
	        	record.telephone = response.msg;
	        	record.mobile = "";
	        	record.email = "";
	        	$scope.errorMsg=response.msg;
	        }
	   	}).error(function(){
	        $scope.errorMsg="服务器没有响应！";
	    });
	};
		
	//初始化函数
    var init = function() {
        $scope.getMyContact();
    };
    init();		
}]);
