var courseScheduleCtrl = angular.module('dc.controller.courseSchedule.courseScheduleCtrl', []);	
courseScheduleCtrl.controller("courseScheduleController",['$scope','$http',function($scope,$http){
	$scope.errorMsg = "";
	$scope.deptList=null;
	$scope.courseTypeList=null;
	$scope.courses=null;
	$scope.courseCount=0;
	$scope.getDeptList = function(){
		$http({
			method:'GET',
		    dataType: "json",
		    contentType:'application/json; charset=UTF-8',
		    url:'/publicQuery/ctrl/common/util/retrJxDeptList.do'
		}).success(function(response){
		    if(response.success==true){
		    	$scope.deptList = response.rows;
		   	}
		}).error(function(){
			$scope.deptList = null;
		    $scope.errorMsg ="服务器没有响应";
		});
	};
	
	$scope.getCourseTypeList = function(tableType){
		if(""!=tableType){
			$http({
		   		method:'GET',
		        dataType: "json",
		        contentType:'application/json; charset=UTF-8',
		       	url:'/publicQuery/ctrl/common/util/retrStudentCourseType.do',
		        params:{type:tableType}
		    }).success(function(response){
		        if(response.success==true){
		        	$scope.courseTypeList = response.rows;
		        }
		   	}).error(function(){
		   		$scope.courseTypeList = null;
		        $scope.errorMsg ="服务器没有响应";
		    });
		}
	};
		
	$scope.retrCourseTable = function(){
		var year=$scope.year;
		var dept=$scope.dept;
		var tableType=$scope.tableType;
		var term=$scope.term;
		var name=$scope.name;
		var courseType=$scope.courseType;
		if(""!=dept && ""!=tableType){
			$http({
		    	method:'POST',
		        dataType: "json",
		        contentType:'application/json; charset=UTF-8',
		        url:'/publicQuery/ctrl/common/courseQuery/retrCourseScheduleList.do',
		        data:{
		        	year:year,
		        	term:term,
		        	deptId:dept,
		        	courseName:name,
		        	courseScheduleType:tableType,
		        	courseType:courseType
		        },
		        headers:{
		        	'Content-Type':'application/json'
		        }
			}).success(function(response){
		        if(response.success==true){
		     		$scope.courses = response.rows;
		        	$scope.courseCount = response.results;
		        	$scope.errorMsg=response.msg
		        }else{
		        	$scope.courses = null;
		        	$scope.courseCount = 0;
		        	$scope.errorMsg=response.msg
		        }
		   	}).error(function(){
		        $scope.courses = null;
        		$scope.courseCount = 0;
				$scope.errorMsg="服务器没有响应"
		    });
		}else{
			$scope.courses = null;
        	$scope.courseCount = 0;
			$scope.errorMsg="请输入必要的查询条件"
		}
	};
		
    //初始化函数
    var init = function() {
    	$scope.getDeptList();
 	};
    init();
}]);